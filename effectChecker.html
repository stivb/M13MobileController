﻿<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
    <link rel="stylesheet" href="css/themes/stompbox.css"   type="text/css"/>
    <script type="text/javascript" src="cordova.js"></script>
    <script src="js/combined.js"></script>
    <script src="js/jquery-1.12.4.min.js"></script>
    <script src="js/jquery.mobile-1.4.5.min.js"></script>
    <link rel="stylesheet" type="text/css" href = "css/effects.css"/>
<script src="js/effects.js"></script>
</head>
<body data-theme="a">
<div data-role="page" id="EffectChainPage">
    <div data-role="header" id="EffectChainPageHeaderTitle">
        Song Title
    </div>
    <div data-role="content" >
        <div class="ui-grid-c">
            <div class="ui-block-a"><a data-role="button" id="BtnFx1" class="btnFxChooser">Fx 1</a></div>
            <div class="ui-block-b"><a data-role="button" id="BtnFx2" class="btnFxChooser">Fx 2</a></div>
            <div class="ui-block-c"><a data-role="button" id="BtnFx3" class="btnFxChooser">Fx 3</a></div>
            <div class="ui-block-d"><a data-role="button" id="BtnFx4" class="btnFxChooser">Fx 4</a></div>
        </div><!-- /grid-c -->
        <span class="effectName" id="spanFx1">Effect 1</span>
        <div class="ui-grid-b effect" id="DivFx1">

            <div class="ui-block-a param" >

            </div>
            <div class="ui-block-b param">
                <span class="paramName whiteonblack">Param 2</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param">
                <span class="paramName whiteonblack">Param 3</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-a param">
                <span class="paramName whiteonblack">Param 4</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-b param">
                <span class="paramName whiteonblack">Param 5</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param">
                <span class="paramName whiteonblack">Param 6</span>
                <div class="percentIndicator"></div>
            </div>
        </div>
        <span class="effectName" id="spanFx2">Effect 2</span>
        <div class="ui-grid-b effect" id="DivFx2">
            <div class="ui-block-a param">

            </div>
            <div class="ui-block-b param">
                <span class="paramName whiteonblack">Param 2</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param">
                <span class="paramName whiteonblack">Param 3</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-a param">
                <span class="paramName whiteonblack">Param 4</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-b param">
                <span class="paramName whiteonblack">Param 5</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param">
                <span class="paramName whiteonblack">Param 6</span>
                <div class="percentIndicator"></div>
            </div>
        </div>
        <span class="effectName" id="spanFx3">Effect 3</span>
        <div class="ui-grid-b effect" id="DivFx3">
            <div class="ui-block-a param">

            </div>
            <div class="ui-block-b param">
                <span class="paramName whiteonblack">Param 2</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param">
                <span class="paramName whiteonblack">Param 3</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-a param">
                <span class="paramName whiteonblack">Param 4</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-b param">
                <span class="paramName whiteonblack">Param 5</span>
                <div class="percentIndicator"></div><
            </div>
            <div class="ui-block-c param">
                <span class="paramName whiteonblack">Param 6</span>
                <div class="percentIndicator"></div>
            </div>
        </div>
        <span class="effectName" id="spanFx4">Effect 4</span>
        <div class="ui-grid-b effect" id="DivFx4">
            <div class="ui-block-a param">

            </div>
            <div class="ui-block-b param">
                <span class="paramName whiteonblack">Param 2</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param">
                <span class="paramName whiteonblack">Param 3</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-a param">
                <span class="paramName whiteonblack">Param 4</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-b param">
                <span class="paramName whiteonblack">Param 5</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param">
                <span class="paramName whiteonblack">Param 6</span>
                <div class="percentIndicator"></div>
            </div>
        </div>
    </div>
    <div data-role="footer" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#" id="saveFxChain" data-role="button">Save</a></li>
                <li><a href="#" id="cancelFxChain" data-role="button">Cancel</a></li>
                <li><a href="#" id="mailFxChain" data-role="button">Email</a></li>
            </ul>
        </div>
    </div>

    <div data-role="popup" id="EffectChooserPage" data-overlay-theme="b">

            <div class="ui-grid-d EffectChooser">

                <div class="ui-block-a">
                    <a class="effectGroupBtn fuzz" data-role="button">Fuzz</a>
                </div>
                <div class="ui-block-b">
                    <a class="effectGroupBtn delay" data-role="button">Delay</a>
                </div>
                <div class="ui-block-c">
                    <a class="effectGroupBtn filter" data-role="button">Filter</a>
                </div>
                <div class="ui-block-d">
                    <a class="effectGroupBtn modulation" data-role="button">Modulation</a>
                </div>
                <div class="ui-block-e">
                    <a class="effectGroupBtn reverb" data-role="button">Reverb</a>
                </div>
            </div>
        <div class="ui-grid-d EffectChooser">
            <div class="ui-block-a">
                <div class="downward">Distortion</div>
            </div>
            <div class="ui-block-b">
                <div class="downward">Delay</div>
            </div>
            <div class="ui-block-c">
                <p class="downward">Filter</p>
            </div>
            <div class="ui-block-d">
                <p class="downward">Reverb</p>
            </div>
            <div class="ui-block-e">
                <p class="downward">Modulation</p>
            </div>
        </div>
            <ul id="effectList" data-role="listview" data-inset="true">
            </ul>
        <a id="effectGroupCancel" data-role="button">Cancel</a>
        </div>

    <div data-role="popup" id="effectHelpPopup" class="ui-content" data-theme="a" style="max-width:350px;">
        <p id="effectHelpText"></span>
    </div>


    <div data-role="popup" data-overlay-theme="b" id="EffectTweakerPage" >
        <div class="ui-grid-b effect">
            <div class="ui-block-a param">

            </div>
            <div class="ui-block-b param etp">
                <span class="paramName whiteonblack ">Param 2</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param etp">
                <span class="paramName whiteonblack ">Param 3</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-a param etp">
                <span class="paramName whiteonblack ">Param 4</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-b param etp">
                <span class="paramName whiteonblack ">Param 5</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param etp">
                <span class="paramName whiteonblack ">Param 6</span>
                <div class="percentIndicator"></div>
            </div>
        </div>

        <div data-role="fieldcontain"  class="slider etp">
            <span class="whiteonblack paramNameLabel"> Param 1</span>
            <label for="slider1" ></label>
            <input type="range" id="slider1" value="50" min="0" max="100" step="1" onchange="doUpdate(this)"
            />
        </div>
        <div data-role="fieldcontain"  class="slider etp">
            <span class="whiteonblack paramNameLabel"> Param 1</span>
            <label for="slider2" ></label>
            <input type="range" id="slider2" value="50" min="0" max="100" step="1" onchange="doUpdate(this)"
            />
        </div>
        <div data-role="fieldcontain" class="slider etp">
            <span class="whiteonblack paramNameLabel"> Param 1</span>
            <label for="slider3" ></label>
            <input type="range" id="slider3" value="50" min="0" max="100" step="1" onchange="doUpdate(this)"
            />
        </div>
        <div data-role="fieldcontain" class="slider etp">
            <span class="whiteonblack paramNameLabel"> Param 1</span>
            <label for="slider4" ></label>
            <input type="range" id="slider4" value="50" min="0" max="100" step="1" onchange="doUpdate(this)"
            />
        </div>
        <div data-role="fieldcontain"  class="slider etp ">
            <span class="whiteonblack paramNameLabel"> Param 1</span>
            <label for="slider5" ></label>
            <input type="range" id="slider5" value="50" min="0" max="100" step="1" onchange="doUpdate(this)"
            />
        </div>
        <div data-role="fieldcontain"  class="slider etp">
            <span class="whiteonblack paramNameLabel"> Param 1</span>
            <label for="slider6" ></label>
            <input type="range" id="slider6" value="50" min="0" max="100" step="1" onchange="doUpdate(this)"
            />
        </div>

        <div class="ui-grid-b">
            <div class="ui-block-a">
                <a data-role="button" id="EffectTweakerPageOk">Ok</a>
            </div>
            <div class="ui-block-b">
                <a data-role="button" id="EffectTweakerPageCancel">Cancel</a>
            </div>
            <div class="ui-block-c">
                <a data-role="button" id="EffectTweakerPageRemove">Remove</a>
            </div>
        </div>



    </div>

    <div data-role="popup" id="effectPrintout" data-overlay-theme="a" class="ui-content" data-theme="a">
        <div data-role="header">EFFECT PRINTOUT</div>
        <div data-role="content" id="transcript"></div>
        <label for="userNotes"></label>
        <input type="text" id="userNotes"/>
        <a data-role="button"  href="#" id="emailPrintout" >Email Description of These Effects</a>
        <a data-role="button"  href="#" id="closeEffectPrintout" >Close</a>

    </div>

    </div>




<script>

    /*
    $( document ).ready(function() {

        if (localStorage["savedFxChains"]) {
            fxChains = JSON.parse(localStorage["savedFxChains"]);
        }
        else fxChains = new Object();
    });

    var fX = [{"Effect":"4 Band Shift EQ","LO":"34","LMID":"25","HMID":"18","HI":"9","SHFT":"6","EffectsGroup":"Fuzz","EffectColor":"Yellow"},
        {"Effect":"Bass Octaver","Drive":"33","Bass":"38","Mid":"26","Treble":"32","Output":"30","EffectsGroup":"Fuzz","EffectColor":"Yellow"},
        {"Effect":"Comet Trails","Freq":"79","Q (Width)":"40","Speed":"56","Gain":"83","Mix":"46","EffectsGroup":"Filter","EffectColor":"fuchsia"},
        {"Effect":"Reverse","Time":"39","Fdbk":"74","Mod Speed":"51","Mod Depth":"33","Mix":"36","EffectsGroup":"Delay","EffectColor":"lime"}];

    //console.log(jQuery.param(populatedFx));

    //var fX = new Array({},{},{},{});
    //var fX = populatedFx;
    var currEffectNum=-1;
    */

    var fX;




    $(document).on('pagebeforeshow', '#EffectChainPage', function(){
        var theChainName = getCurrentPbfxChainName();
        $("#EffectChainPageHeaderTitle").text(theChainName);
        fX = loadFxChainState(theChainName);
        if(jQuery.isEmptyObject(fX)) return;
        for (var i = 1;i<5 ;i++)
        {
            currEffectNum=i;
            paintEffects(i);
            $('#EffectChainPage').trigger('create');
        }
        //if (theChainName!="") $('#mailFxChain').attr("href", printOut(theChainName,fX));

    });

    //when the user clicks on one of the 5 groups of effects (fuzz/reverb/delay/modulation/filters)
    $( ".effectGroupBtn" ).click(function() {

        var filterGroup = $(this).text();
        var effectsToShow = allEffectNamesByGroup(filterGroup);
        var cList = $('#effectList');
        cList.empty();
        //updating the list with all the effects from that group of effects
        $.each(effectsToShow, function(i)
        {
            var li = $('<li/>').appendTo(cList);
            var aaa = $('<a/>').text(effectsToShow[i]).addClass("effectChoice").appendTo(li);
            aaa.addClass(filterGroup + "text");
            var qqq = $('<a/>').text(effectsToShow[i]).addClass("effectHelp").appendTo(li);
        });
        cList.listview( "refresh" );
    });

    //user choosing which one in the effect chaing (fx1,fx2,fx3,fx4) to activate
    $( ".btnFxChooser" ).click(function() {

        $( "#EffectChooserPage").popup();
        $( "#EffectChooserPage" ).popup( "open" );
        var id = $(this).attr("id");
        currEffectNum = id.slice(-1)*1;
    });


    //clicking on one of the 4 big boxes for "effects"
    $(".effect").click(function() {

        var id = $(this).attr("id");
        currEffectNum = id.slice(-1)*1; //0,1,2,3 depending on which effect (1-4))
        var currEffect = fX[currEffectNum-1] ;//initialized as one item in a 4 item empty array

        if (currEffect.Effect==null || currEffect.Effect=="")
        {
            $( "#EffectChooserPage").popup();
            $( "#EffectChooserPage" ).popup( "open" );
            return;
        }

        $( "#EffectTweakerPage").popup();
        $( "#EffectTweakerPage" ).popup( "open" );

        //$(':input[type="number"]').prop("disabled", true);



        /*
        paramNames are just the names of things you can set for that effect
        e.g "fbk" "q" - the things per effect
        excluding merely formatting stuff like  .EffectColor (color)  .Effect (effect name) and .EffectsGroup
        paramNames are just the things you can set
        you can get the VALUE per effect by
        currEffect[value]
         */
        var paramNames = removeNonNumericFromArray(Object.keys(currEffect));
        $( ".etp").hide();
        $( "#EffectTweakerPage").css("background-color",currEffect.EffectColor);

        /*
        these are lists of sliders labels slider headers and param boxes per effect
        e.g q fbk etc etc
        each one represents a bag of names and values per setting (fbk q etc)
         */
        var sliders = $("#EffectTweakerPage").find(".slider");
        var labels =  $("#EffectTweakerPage").find(".paramName");
        var sliderHeaders = $("#EffectTweakerPage").find(".paramNameLabel");
        var paramBoxes = $("#EffectTweakerPage").find(".percentIndicator");


        /*
        here what you have is an array of strings and values - e.g q - 60 fbk 90
         */
        $.each(paramNames, function( index, settableThingName ) {
            var currPc = currEffect[settableThingName];
            var shownThingName = getTitleAndNotch(settableThingName,currPc);
            $(labels[index]).text(shownThingName);   //
            $(labels[index]).parent().show();
            $(sliderHeaders[index]).text(shownThingName);
            $(sliders[index]).show();
            $("#slider" + (index+1)).val(currPc).slider().slider('refresh');
            $(paramBoxes[index]).css("background-image",pc(currPc));
        });

        //$(".ui-slider-input").css("visibility","hidden");
        $(".ui-slider-input").attr('readonly', 'readonly');


    });



    $("#mailFxChain").click(function() {
        var s = printOut(getCurrentPbfxChainName(),fX);
        s = s.replace(/^.*?---/,"<br/><br/>---");
        s = "<div>" + s.replace(/%0D%0A/g,"<br/>") + "</div>";

        $("#transcript").html(s);
        $( "#effectPrintout").popup();
        $( "#effectPrintout" ).popup( "open" );

    });

    $("#emailPrintout").click(function() {
        var s = printOut(getCurrentPbfxChainName(),fX);
        var tobeEmailed = s + "%0D%0A Notes:" + $('#userNotes').val();
        window.open(tobeEmailed, '_system');

    });




    $("#closeEffectPrintout").click(function() {
        $("#effectPrintout").popup( "close" );

    });


    function updateEffects(effectNum)
    {
        var currEffect = fX[effectNum-1] ;//an item from the 4 object array

        var paramNames = removeNonNumericFromArray(Object.keys(currEffect));//gets rid of non settableThingName items

        var targetEffectsDiv = "#DivFx" + effectNum;
        $( "#DivFx"+ effectNum ).css("background-color",currEffect.EffectColor);
        var paramBoxes = $(targetEffectsDiv).find(".percentIndicator");
        var paramNameHolders = $(targetEffectsDiv).find(".paramName");
        $.each(paramNames, function( index, value ) {
            currEffect[value] = $("#slider" + (index+1) ).val();  //saves a numerical value for each of the settableThingNames
            $(paramBoxes[index]).css("background-image",pc(currEffect[value]));
            var nome = paramNames[index];
            $(paramNameHolders[index]).text(getTitleAndNotch(nome,currEffect[value]));

        });
        $('#mailFxChain').attr("href", printOut(getCurrentPbfxChainName(),fX));

    }





    /*
    used to reflect the json onto the the screen of the effects page
    this is for (one of the four) effects in a chain
     */
    function paintEffects(effectNum)
    {

        var currEffect = fX[effectNum-1];
        $( "#spanFx"+ effectNum ).text(currEffect.Effect);
        $( "#DivFx"+ effectNum ).children().css("visibility", "hidden");
        $( "#DivFx"+ effectNum ).css("background-color",currEffect.EffectColor);


        var paramNames = removeNonNumericFromArray(Object.keys(currEffect));
        var targetEffectsDiv = "#DivFx" + effectNum;

        var paramBoxes = $(targetEffectsDiv).find(".percentIndicator");
        var paramNameHolders = $(targetEffectsDiv).find(".paramName");
        $( "#DivFx"+ effectNum ).find( ".paramName" ).each(function(index,elmt){
            if (paramNames.length>index)
                {
                var nome = paramNames[index];
                var numericValue = currEffect[nome];
                $(paramNameHolders[index]).text(nome);
                $(paramBoxes[index]).css("background-image",pc(numericValue));
                $(this).parent().css("visibility","visible");


                $(paramNameHolders[index]).text(getTitleAndNotch(nome,numericValue));
                }
        });

    }

    $("#EffectTweakerPageOk").click(function() {
        updateEffects(currEffectNum);
        $( "#EffectTweakerPage" ).popup( "close" );
    });

    $("#EffectTweakerPageCancel").click(function() {
        $( "#EffectTweakerPage" ).popup( "close" );
    });

    $("#effectGroupCancel").click(function() {
        $( "#EffectChooserPage" ).popup( "close" );
    });

    $("#EffectTweakerPageRemove").click(function() {
        fX[currEffectNum-1] = new Array();
        $( "#DivFx"+ currEffectNum ).css("background-color","#f9f9f9");
        $( "#DivFx"+ currEffectNum ).children().css("visibility", "hidden");
        $( "#spanFx"+ currEffectNum ).text("Effect " + currEffectNum);
        $( "#EffectTweakerPage" ).popup( "close" );
    });


    $('body').on('click', 'a.effectChoice', function() {
        var fxName = $(this).text();
        $( "#EffectChooserPage" ).popup( "close" );
        $("#spanFx" + currEffectNum).text(fxName );
        var currEffect = getEffect(fxName );
        fX[currEffectNum-1] = currEffect;
        var paramNames = removeNonNumericFromArray(Object.keys(currEffect));
        $( "#DivFx"+ currEffectNum ).find(".percentIndicator").css("background-image",pc(0));
        $( "#DivFx"+ currEffectNum ).children().css("visibility", "hidden");
        $( "#DivFx"+ currEffectNum ).css("background-color",currEffect.EffectColor);
        $( "#DivFx"+ currEffectNum ).find( ".paramName" ).each(function(index,elmt){

            if (paramNames.length>index)
            {
                $(this).text(getTitleAndNotch(paramNames[index],0));
                $(this).parent().css("visibility","visible");
            }
        });

    });

    $('body').on('click', 'a.effectHelp', function() {
        var fxName = $(this).attr('title');
        alert(effectDescriptions[fxName]);
    });



    //a function which mirrors in the small pc indicators the movement in the sliders
    function doUpdate(obj)
    {
        var i = obj.id.charAt(obj.id.length-1)-1;


        var currEffect = fX[currEffectNum-1] ;//initialized as one item in a 4 item empty array
        var keys =  removeNonNumericFromArray(Object.keys(currEffect));


        var val = obj.value;
        var paramBoxes = $("#EffectTweakerPage").find(".percentIndicator");
        $(paramBoxes[i]).css("background-image",pc(val));
        var paramLabels = $("#EffectTweakerPage").find(".paramName");
        $(paramLabels[i]).text(getTitleAndNotch(keys[i],val));
        var paramNameLabels = $("#EffectTweakerPage").find(".paramNameLabel");
        $(paramNameLabels[i]).text(getTitleAndNotch(keys[i],val));
    }
    function visualizeFx(num)
    {

    }

    //creates a css value from a percentage - so visually show the percent value
    function pc(percent)
    {
        var retval ="linear-gradient(to right,black,black x%,white x%)";
        //var retval = "linear-gradient(to right, black, white x%)";
        retval = retval.replace(/x%/g,"" + percent + "%");
        return retval;
    }

    $('#saveFxChain').on('click', function() {
        saveFxChain();
    });

    $('#cancelFxChain').on('click', function() {
        cancelFxChain();
    });


    function saveFxChain()
    {
        saveFxChainState(getCurrentPbfxChainName(),fX);
        window.location.href="index.html#SongListPage";
    }

    function cancelFxChain()
    {
        window.location.href="index.html#SongListPage";
    }
</script>
</body>
</body>
</html>
