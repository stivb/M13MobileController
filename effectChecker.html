<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <link rel="stylesheet" type="text/css" href = "css/effects.css"/>
<script src="js/effects.js"></script>
</head>
<body>
<div data-role="page" id="EffectChainPage">
    <div data-role="header" >
        Song Title
    </div>
    <div data-role="content" >
        <div class="ui-grid-c">
            <div class="ui-block-a"><a data-role="button" id="BtnFx1" class="btnFxChooser">Fx 1</a></div>
            <div class="ui-block-b"><a data-role="button" id="BtnFx2" class="btnFxChooser">Fx 2</a></div>
            <div class="ui-block-c"><a data-role="button" id="BtnFx3" class="btnFxChooser">Fx 3</a></div>
            <div class="ui-block-d"><a data-role="button" id="BtnFx4" class="btnFxChooser">Fx 4</a></div>
        </div><!-- /grid-c -->
        <span class="effectName" id="spanFx1">Effect 1</span>
        <div class="ui-grid-b effect" id="DivFx1">

            <div class="ui-block-a param" >
                <span class="paramName">Param 1</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-b param">
                <span class="paramName">Param 2</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param">
                <span class="paramName">Param 3</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-a param">
                <span class="paramName">Param 4</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-b param">
                <span class="paramName">Param 5</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param">
                <span class="paramName">Param 6</span>
                <div class="percentIndicator"></div>
            </div>
        </div>
        <span class="effectName" id="spanFx2">Effect 2</span>
        <div class="ui-grid-b effect" id="DivFx2">
            <div class="ui-block-a param">
                <span class="paramName">Param 1</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-b param">
                <span class="paramName">Param 2</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param">
                <span class="paramName">Param 3</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-a param">
                <span class="paramName">Param 4</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-b param">
                <span class="paramName">Param 5</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param">
                <span class="paramName">Param 6</span>
                <div class="percentIndicator"></div>
            </div>
        </div>
        <span class="effectName" id="spanFx3">Effect 3</span>
        <div class="ui-grid-b effect" id="DivFx3">
            <div class="ui-block-a param">
                <span class="paramName">Param 1</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-b param">
                <span class="paramName">Param 2</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param">
                <span class="paramName">Param 3</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-a param">
                <span class="paramName">Param 4</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-b param">
                <span class="paramName">Param 5</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param">
                <span class="paramName">Param 6</span>
                <div class="percentIndicator"></div>
            </div>
        </div>
        <span class="effectName" id="spanFx4">Effect 4</span>
        <div class="ui-grid-b effect" id="DivFx4">
            <div class="ui-block-a param">
                <span class="paramName">Param 1</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-b param">
                <span class="paramName">Param 2</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param">
                <span class="paramName">Param 3</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-a param">
                <span class="paramName">Param 4</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-b param">
                <span class="paramName">Param 5</span>
                <div class="percentIndicator"></div>
            </div>
            <div class="ui-block-c param">
                <span class="paramName">Param 6</span>
                <div class="percentIndicator"></div>
            </div>
        </div>
    </div>
    <div data-role="footer" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#" data-role="button">Save</a></li>
                <li><a href="#" data-role="button">Cancel</a></li>
            </ul>
        </div>
    </div>

        <div data-role="popup" id="EffectChooserPage">

            <div class="ui-grid-d EffectChooser">

                <div class="ui-block-a">
                    <a class="effectGroupBtn" data-role="button">Fuzz</a>
                </div>
                <div class="ui-block-b">
                    <a class="effectGroupBtn" data-role="button">Delay</a>
                </div>
                <div class="ui-block-c">
                    <a class="effectGroupBtn" data-role="button">Filter</a>
                </div>
                <div class="ui-block-d">
                    <a class="effectGroupBtn" data-role="button">Modulation</a>
                </div>
                <div class="ui-block-e">
                    <a class="effectGroupBtn" data-role="button">Reverb</a>
                </div>
            </div>
            <ul id="effectList" data-role="listview" data-inset="true">
            </ul>

        </div>



        <div data-role="popup" id="EffectTweakerPage">
                <div class="ui-grid-b effect">
                    <div class="ui-block-a param etp">
                        <span class="paramName">Param 1</span>
                        <div class="percentIndicator"></div>
                    </div>
                    <div class="ui-block-b param etp">
                        <span class="paramName">Param 2</span>
                        <div class="percentIndicator"></div>
                    </div>
                    <div class="ui-block-c param etp">
                        <span class="paramName">Param 3</span>
                        <div class="percentIndicator"></div>
                    </div>
                    <div class="ui-block-a param etp">
                        <span class="paramName">Param 4</span>
                        <div class="percentIndicator"></div>
                    </div>
                    <div class="ui-block-b param etp">
                        <span class="paramName">Param 5</span>
                        <div class="percentIndicator"></div>
                    </div>
                    <div class="ui-block-c param etp">
                        <span class="paramName">Param 6</span>
                        <div class="percentIndicator"></div>
                    </div>
                </div>

                <div data-role="fieldcontain"  class="slider etp">
                    <p> Param 1</p>
                    <label for="slider1"></label>
                    <input type="range" id="slider1" value="50" min="0" max="100" step="1" onchange="doUpdate(this)"
                    />
                </div>
                <div data-role="fieldcontain"  class="slider etp">
                    <p> Param 1</p>
                    <label for="slider2"></label>
                    <input type="range" id="slider2" value="50" min="0" max="100" step="1" onchange="doUpdate(this)"
                    />
                </div>
                <div data-role="fieldcontain" class="slider etp">
                    <p> Param 1</p>
                    <label for="slider3"></label>
                    <input type="range" id="slider3" value="50" min="0" max="100" step="1" onchange="doUpdate(this)"
                    />
                </div>
                <div data-role="fieldcontain" " class="slider etp">
                    <p> Param 1</p>
                    <label for="slider4"></label>
                    <input type="range" id="slider4" value="50" min="0" max="100" step="1" onchange="doUpdate(this)"
                    />
                </div>
                <div data-role="fieldcontain"  class="slider etp ">
                    <p> Param 1</p>
                    <label for="slider5"></label>
                    <input type="range" id="slider5" value="50" min="0" max="100" step="1" onchange="doUpdate(this)"
                    />
                </div>
                <div data-role="fieldcontain"  class="slider etp">
                    <p> Param 1</p>
                    <label for="slider6"></label>
                    <input type="range" id="slider6" value="50" min="0" max="100" step="1" onchange="doUpdate(this)"
                    />
                </div>

                <div class="ui-grid-b">
                    <div class="ui-block-a">
                        <a data-role="button" id="EffectTweakerPageOk">Ok</a>
                    </div>
                    <div class="ui-block-b">
                        <a data-role="button" id="EffectTweakerPageCancel">Cancel</a>
                    </div>
                    <div class="ui-block-c">
                        <a data-role="button" id="EffectTweakerPageRemove">Remove</a>
                    </div>
                </div>



        </div>
    </div>
</div>

<script>

    var populatedFx = {fx1:{"Effect":"4 Band Shift EQ","LO":"34","LMID":"25","HMID":"18","HI":"9","SHFT":"6","EffectsGroup":"Fuzz","EffectColor":"Yellow"},
        fx2:{"Effect":"Bass Octaver","Drive":"33","Bass":"38","Mid":"26","Treble":"32","Output":"30","EffectsGroup":"Fuzz","EffectColor":"Yellow"},
        fx3:{"Effect":"Comet Trails","Freq":"79","Q (Width)":"40","Speed":"56","Gain":"83","Mix":"46","EffectsGroup":"Filter","EffectColor":"fuchsia"},
        fx4:{"Effect":"Reverse","Time":"39","Fdbk":"74","Mod Speed":"51","Mod Depth":"33","Mix":"36","EffectsGroup":"Delay","EffectColor":"lime"}};

    console.log(jQuery.param(populatedFx));

    var fX = new Array({},{},{},{});
    var currEffectNum=-1;
    $( ".effectGroupBtn" ).click(function() {

        var filterGroup = $(this).text();
        var effectsToShow = allEffectNamesByGroup(filterGroup);
        var cList = $('#effectList');
        cList.empty();
        $.each(effectsToShow, function(i)
        {
            var li = $('<li/>').appendTo(cList);
            var aaa = $('<a/>').text(effectsToShow[i]).addClass("effectChoice").appendTo(li);
        });
        cList.listview( "refresh" );
    });

    $( ".btnFxChooser" ).click(function() {

        $( "#EffectChooserPage").popup();
        $( "#EffectChooserPage" ).popup( "open" );
        var id = $(this).attr("id");
        currEffectNum = id.slice(-1)*1;

    });

    $(".effect").click(function() {

        var id = $(this).attr("id");
        currEffectNum = id.slice(-1)*1;
        var currEffect = fX[currEffectNum-1] ;
        $( "#EffectTweakerPage").popup();
        $( "#EffectTweakerPage" ).popup( "open" );
        var paramNames = removeNonNumericFromArray(Object.keys(currEffect));
        $( ".etp").css("visibility", "hidden");
        $( "#EffectTweakerPage").css("background-color",currEffect.EffectColor);
        var sliders = $("#EffectTweakerPage").find(".slider");
        var labels =  $("#EffectTweakerPage").find(".paramName");
        var sliderHeaders = $("#EffectTweakerPage").find("p");
        var paramBoxes = $("#EffectTweakerPage").find(".percentIndicator");
       // alert($(labels[0]).text());
        $.each(paramNames, function( index, value ) {
            $(labels[index]).text(value);
            $(labels[index]).parent().css("visibility","visible");
            $(sliderHeaders[index]).text(value);
            $(sliders[index]).css("visibility","visible");
            $("#slider" + (index+1)).val(currEffect[value]).slider().slider('refresh');
            $(paramBoxes[index]).css("background-image",pc(currEffect[value]));
        });

    });

    $("#EffectTweakerPageOk").click(function() {
        var currEffect = fX[currEffectNum-1] ;
        var paramNames = removeNonNumericFromArray(Object.keys(currEffect));
        var targetEffectsDiv = "#DivFx" + currEffectNum;
        var paramBoxes = $(targetEffectsDiv).find(".percentIndicator");
        $.each(paramNames, function( index, value ) {
            currEffect[value] = $("#slider" + (index+1) ).val();
            $(paramBoxes[index]).css("background-image",pc(currEffect[value]));
        });
        $( "#EffectTweakerPage" ).popup( "close" );
        console.log(JSON.stringify(currEffect));
    });

    $("#EffectTweakerPageCancel").click(function() {
        $( "#EffectTweakerPage" ).popup( "close" );
    });

    $("#EffectTweakerPageRemove").click(function() {
        fX[currEffectNum-1] = null;
        $( "#DivFx"+ currEffectNum ).css("background-color","#f9f9f9");
        $( "#DivFx"+ currEffectNum ).children().css("visibility", "hidden");
        $( "#EffectTweakerPage" ).popup( "close" );
    });


    $('body').on('click', 'a.effectChoice', function() {
        var fxName = $(this).text();
        $( "#EffectChooserPage" ).popup( "close" );
        $("#spanFx" + currEffectNum).text(fxName );
        var currEffect = getEffect(fxName );
        fX[currEffectNum-1] = currEffect;
        var paramNames = removeNonNumericFromArray(Object.keys(currEffect));
        $( "#DivFx"+ currEffectNum ).find(".percentIndicator").css("background-image",pc(0));
        $( "#DivFx"+ currEffectNum ).children().css("visibility", "hidden");
        $( "#DivFx"+ currEffectNum ).css("background-color",currEffect.EffectColor);
        $( "#DivFx"+ currEffectNum ).find( ".paramName" ).each(function(index,elmt){

            if (paramNames.length>index)
            {
                $(this).text(paramNames[index]);
                $(this).parent().css("visibility","visible");
            }
        });

    });

    function doUpdate(obj)
    {
        var i = obj.id.charAt(obj.id.length-1)-1;
        var val = obj.value;
        var paramBoxes = $("#EffectTweakerPage").find(".percentIndicator");
        $(paramBoxes[i]).css("background-image",pc(val));
    }
    function visualizeFx(num)
    {

    }

    function pc(percent)
    {
        var retval = "linear-gradient(to right, black, white x%)";
        retval = retval.replace("x%","" + percent + "%");
        return retval;
    }
</script>
</body>
</body>
</html>
